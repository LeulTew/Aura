# Comprehensive Test Plan for Aura

This document outlines the end-to-end testing strategy for Aura, covering all user roles and critical workflows. Use this guide to verify the system from a holistic perspective.

## 1. Prerequisites & Setup

Before starting, ensure the following entries exist in your database (or create them via SQL/Admin).

### A. User Accounts

| Role               | Email               | Password         | Context               |
| :----------------- | :------------------ | :--------------- | :-------------------- |
| **SuperAdmin**     | `super@aura.test`   | _(Set Manually)_ | Platform Owner        |
| **Business Owner** | `owner@studio.test` | _(Set Manually)_ | Owner of Studio A & B |
| **Photographer**   | `photo@studio.test` | _(Set Manually)_ | Staff at Studio A     |
| **Customer**       | _(Self-Register)_   | _N/A_            | End User              |

> **Note**: Passwords are managed via Supabase Auth. Use the signup flow or Supabase dashboard to create these initially.

### B. Organizations

1. **Studio A** (Primary)
2. **Studio B** (Secondary)

---

## 2. SuperAdmin Workflow (Platform Management)

**Goal**: Verify platform health and tenant oversight.

- [ ] **Login**: Sign in as `super@aura.test`.
- [ ] **Dashboard Check**:
  - Verify "Platform Health" stats (Total Org, Storage, Active Users).
  - Ensure graph/metrics load without error.
- [ ] **Tenant Oversight**:
  - Navigate to `Organizations` list.
  - Click "Manage" on _Studio A_ -> Verify instant login as Admin of Studio A.
  - Click "Manage" on _Studio B_ -> Verify context switch.
- [ ] **Security Check**: Attempt to access `/api/owner/*` directly via Postman (should work) but verify RLS (row level security) prevents seeing data from _Studio C_ (if it existed).

---

## 3. Business Owner Workflow (The Core Loop)

**Goal**: Manage multiple studios, employees, and QR generation.

### A. Context Switching (Phase 6 Feature)

- [ ] **Login**: Sign in as `owner@studio.test`.
- [ ] **Dashboard**: Verify "Owner Dashboard" shows aggregated stats (Total Storage across A & B).
- [ ] **Studio Switcher**:
  - Click Studio Name in Sidebar top-left.
  - Select _Studio B_.
  - Verify page reloads and dashboard now shows _Studio B_ specific data.
  - Switch back to _Studio A_.

### B. Team Management

- [ ] **Invite Photographer**:
  - Go to "Team" section.
  - Invite `new_photographer@test.com`.
  - **Step**: Check Email/Console for invite link.
  - **Step**: Accept invite in Incognito window.
  - Verify new user appears in Team list.

### C. QR Generation (Customer Entry)

- [ ] **Generate General QR**:
  - Go to "Event/QR" settings.
  - Click "Generate New Event QR" (for "Summer Wedding").
  - **Verify**: A unique URL/QR code is generated.
  - **Action**: Print/Save this QR. This is what you put at the venue entrance.

---

## 4. Photographer Workflow (Content & Selection)

**Goal**: Upload photos and create curated selections.

- [ ] **Upload Session**:
  - Login as `photo@studio.test`.
  - Go to "Upload".
  - Drag & drop 20+ photos.
  - **Verify**: Processing (Face Indexing) bar progress.
  - **Verify**: Photos appear in Gallery after processing.

- [ ] **Create "Selects" Link (1-Time Use)**:
  - Go to Gallery.
  - Select 5 specific best photos.
  - Click "Share Selection" / "Create 1-Time Link".
  - **Verify**: A unique, temporary URL is generated.
  - **Action**: Copy this link.
  - **Test**: Open link in Incognito. Verify ONLY those 5 photos are visible.
  - **Test**: Refresh/expire check (if implemented).

---

## 5. Customer Workflow (The AI Experience)

**Goal**: Find my photos using AI Face Search.

### A. Registration (The First Touch)

- [ ] **Scan QR**: Open the "Summer Wedding" QR link (generated by Owner) on Mobile.
- [ ] **Selfie Upload**:
  - Prompt: "Find your photos".
  - Action: Take/Upload a selfie.
  - **Verify**: System analyzes face (no error).

### B. Discovery

- [ ] **AI Search**:
  - System searches _Studio A_ database.
  - **Verify**: Returns photos of the Customer (from the Photographer's upload).
  - **Verify**: Does NOT return random people's photos.
- [ ] **View & Download**:
  - Open a photo.
  - Click "Download High-Res".
  - **Verify**: Download starts (Watermark removed if paid/configured).

---

## 6. End-to-End Verification Check list

| Feature           | Status | Notes                                              |
| :---------------- | :----: | :------------------------------------------------- |
| **RLS Isolation** |  [ ]   | Can User A see User B's photos? (Should be NO)     |
| **Multi-Tenant**  |  [ ]   | Can Studio A see Studio B's photos? (Should be NO) |
| **Face Search**   |  [ ]   | Accuracy > 90% for clear faces?                    |
| **Upload Speed**  |  [ ]   | < 2s per checkout processing?                      |
| **Mobile Layout** |  [ ]   | Does the Client View look good on Phone?           |

## 7. Troubleshooting

- **Supabase Paused?**: If API fails, check Supabase dashboard. Free tier pauses after inactivity.
- **Deployment**: Check GitHub Actions tab for "Deploy to Cloud Run" status.
- **Logs**: Access SuperAdmin Logs (`/superadmin/logs`) for backend error details.
